<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>게임 - FINE U</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .game-card:hover {
            transform: translateY(-2px);
            transition: transform 0.3s ease;
        }
        .rocket {
            transition: transform 0.5s ease;
        }
        .rocket.flying {
            transform: translateY(-100px);
        }
        .dodoori {
            width: 80px;
            height: 80px;
            background: linear-gradient(45deg, #FFE135, #FFA500);
            border-radius: 50%;
            position: relative;
            animation: bounce 2s infinite;
        }
        .dodoori::before {
            content: '🐣';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 40px;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .progress-bar {
            background: linear-gradient(90deg, #3B82F6, #10B981);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen pb-20">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center">
                <button onclick="history.back()" class="mr-4">
                    <i class="fas fa-arrow-left text-xl"></i>
                </button>
                <h1 class="text-xl font-bold">게임</h1>
            </div>
        </div>
    </header>

    <!-- User Game Stats -->
    <div id="gameStatsSection" class="hidden bg-white border-b p-4">
        <div class="grid grid-cols-3 gap-4 text-center">
            <div>
                <p class="text-sm text-gray-600">게임 점수</p>
                <p class="text-lg font-bold text-blue-600" id="totalGamePoints">0</p>
            </div>
            <div>
                <p class="text-sm text-gray-600">퀴즈 정답률</p>
                <p class="text-lg font-bold text-green-600" id="quizAccuracy">0%</p>
            </div>
            <div>
                <p class="text-sm text-gray-600">똑부리 레벨</p>
                <p class="text-lg font-bold text-purple-600" id="dodooriLevel">1</p>
            </div>
        </div>
    </div>

    <!-- Tab Navigation -->
    <div class="bg-white border-b">
        <div class="container mx-auto px-4">
            <div class="flex">
                <button id="quizTab" class="px-6 py-3 text-blue-600 border-b-2 border-blue-600 font-medium">
                    경제 퀴즈
                </button>
                <button id="rocketTab" class="px-6 py-3 text-gray-600 hover:text-blue-600 font-medium">
                    로켓게임
                </button>
                <button id="dodooriTab" class="px-6 py-3 text-gray-600 hover:text-blue-600 font-medium">
                    똑부리 키우기
                </button>
            </div>
        </div>
    </div>

    <!-- Content -->
    <main class="container mx-auto px-4 py-6">
        <!-- Quiz Section -->
        <div id="quizSection">
            <div class="bg-white rounded-lg card-shadow p-6 mb-6">
                <h2 class="text-lg font-bold mb-4 flex items-center">
                    <i class="fas fa-brain text-purple-500 mr-2"></i>
                    경제 퀴즈 게임
                </h2>
                <p class="text-gray-600 mb-4">경제 지식을 테스트하고 점수를 획득하세요!</p>
                
                <!-- Quiz Stats -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="text-center p-4 bg-blue-50 rounded-lg">
                        <p class="text-sm text-gray-600">오늘 풀은 문제</p>
                        <p class="text-2xl font-bold text-blue-600" id="todayQuizCount">0</p>
                    </div>
                    <div class="text-center p-4 bg-green-50 rounded-lg">
                        <p class="text-sm text-gray-600">획득 점수</p>
                        <p class="text-2xl font-bold text-green-600" id="quizPoints">0</p>
                    </div>
                </div>

                <!-- Quiz Game Area -->
                <div id="quizGameArea">
                    <div id="quizStart" class="text-center">
                        <button onclick="startQuiz()" class="bg-blue-600 text-white px-8 py-3 rounded-lg text-lg font-medium hover:bg-blue-700 transition">
                            퀴즈 시작하기
                        </button>
                    </div>

                    <div id="quizActive" class="hidden">
                        <div class="mb-4">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-sm text-gray-600">문제 <span id="currentQuestion">1</span> / 5</span>
                                <span class="text-sm text-gray-600">남은 시간: <span id="timeRemaining">30</span>초</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div id="quizProgress" class="progress-bar h-2 rounded-full" style="width: 20%"></div>
                            </div>
                        </div>

                        <div class="bg-gray-50 p-4 rounded-lg mb-4">
                            <h3 class="text-lg font-bold mb-4" id="questionText"></h3>
                            <div class="space-y-2" id="answerOptions">
                                <!-- Answer options will be populated by JavaScript -->
                            </div>
                        </div>

                        <div class="text-center">
                            <button id="nextQuestion" onclick="nextQuestion()" class="hidden bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition">
                                다음 문제
                            </button>
                        </div>
                    </div>

                    <div id="quizResults" class="hidden text-center">
                        <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg p-6 mb-4">
                            <h3 class="text-xl font-bold mb-2">퀴즈 완료!</h3>
                            <p class="text-lg">점수: <span id="finalScore">0</span> / 100</p>
                            <p class="text-sm opacity-90">정답률: <span id="finalAccuracy">0</span>%</p>
                        </div>
                        <button onclick="resetQuiz()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition">
                            다시 도전하기
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rocket Game Section -->
        <div id="rocketSection" class="hidden">
            <div class="bg-white rounded-lg card-shadow p-6 mb-6">
                <h2 class="text-lg font-bold mb-4 flex items-center">
                    <i class="fas fa-rocket text-orange-500 mr-2"></i>
                    로켓게임 - 투자 타이밍
                </h2>
                <p class="text-gray-600 mb-4">로켓이 폭발하기 전에 적절한 타이밍에 판매하세요!</p>

                <!-- Rocket Game Stats -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="text-center p-4 bg-orange-50 rounded-lg">
                        <p class="text-sm text-gray-600">최고 기록</p>
                        <p class="text-2xl font-bold text-orange-600" id="rocketBestScore">0x</p>
                    </div>
                    <div class="text-center p-4 bg-red-50 rounded-lg">
                        <p class="text-sm text-gray-600">총 수익</p>
                        <p class="text-2xl font-bold text-red-600" id="rocketTotalEarnings">0</p>
                    </div>
                </div>

                <!-- Rocket Game Area -->
                <div id="rocketGameArea">
                    <div id="rocketStart" class="text-center">
                        <div class="mb-4">
                            <div class="rocket text-6xl">🚀</div>
                        </div>
                        <button onclick="startRocketGame()" class="bg-orange-600 text-white px-8 py-3 rounded-lg text-lg font-medium hover:bg-orange-700 transition">
                            게임 시작
                        </button>
                    </div>

                    <div id="rocketActive" class="hidden text-center">
                        <div class="mb-6">
                            <div class="rocket text-8xl mb-4" id="rocketIcon">🚀</div>
                            <div class="text-3xl font-bold text-green-600 mb-2" id="rocketMultiplier">1.00x</div>
                            <div class="text-sm text-gray-600">현재 수익률</div>
                        </div>
                        
                        <div class="mb-4">
                            <div class="text-lg font-bold text-blue-600 mb-2">투자금: <span id="rocketInvestment">10,000</span>원</div>
                            <div class="text-lg font-bold text-green-600">예상 수익: <span id="rocketEarnings">10,000</span>원</div>
                        </div>

                        <button id="cashOutBtn" onclick="cashOut()" class="bg-red-600 text-white px-8 py-3 rounded-lg text-lg font-medium hover:bg-red-700 transition">
                            현금화하기
                        </button>
                    </div>

                    <div id="rocketResult" class="hidden text-center">
                        <div class="mb-4" id="rocketResultIcon">💥</div>
                        <div class="text-xl font-bold mb-2" id="rocketResultText">로켓이 폭발했습니다!</div>
                        <div class="text-lg mb-4" id="rocketResultEarnings">수익: 0원</div>
                        <button onclick="resetRocketGame()" class="bg-orange-600 text-white px-6 py-2 rounded-lg hover:bg-orange-700 transition">
                            다시 게임하기
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dodoori Game Section -->
        <div id="dodooriSection" class="hidden">
            <div class="bg-white rounded-lg card-shadow p-6 mb-6">
                <h2 class="text-lg font-bold mb-4 flex items-center">
                    <i class="fas fa-egg text-yellow-500 mr-2"></i>
                    똑부리 키우기
                </h2>
                <p class="text-gray-600 mb-4">투자 수익으로 똑부리를 키우고 성장시키세요!</p>

                <!-- Dodoori Display -->
                <div class="text-center mb-6">
                    <div class="dodoori mx-auto mb-4"></div>
                    <h3 class="text-lg font-bold" id="dodooriName">똑부리</h3>
                    <p class="text-gray-600" id="dodooriAge">태어난 지 1일</p>
                </div>

                <!-- Dodoori Stats -->
                <div class="space-y-4 mb-6">
                    <div>
                        <div class="flex justify-between mb-1">
                            <span class="text-sm text-gray-600">레벨</span>
                            <span class="text-sm font-medium" id="dodooriLevelText">1</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div id="dodooriLevelProgress" class="bg-yellow-500 h-2 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="flex justify-between mb-1">
                            <span class="text-sm text-gray-600">행복도</span>
                            <span class="text-sm font-medium" id="dodooriHappiness">100%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div id="dodooriHappinessBar" class="bg-green-500 h-2 rounded-full" style="width: 100%"></div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="flex justify-between mb-1">
                            <span class="text-sm text-gray-600">배고픔</span>
                            <span class="text-sm font-medium" id="dodooriHunger">0%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div id="dodooriHungerBar" class="bg-red-500 h-2 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <!-- Dodoori Actions -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <button onclick="feedDodoori()" class="bg-green-500 text-white p-4 rounded-lg hover:bg-green-600 transition">
                        <i class="fas fa-utensils text-2xl mb-2"></i>
                        <p class="font-medium">먹이주기</p>
                        <p class="text-sm opacity-90">1,000원</p>
                    </button>
                    <button onclick="playWithDodoori()" class="bg-blue-500 text-white p-4 rounded-lg hover:bg-blue-600 transition">
                        <i class="fas fa-gamepad text-2xl mb-2"></i>
                        <p class="font-medium">놀아주기</p>
                        <p class="text-sm opacity-90">500원</p>
                    </button>
                    <button onclick="upgradeDodoori()" class="bg-purple-500 text-white p-4 rounded-lg hover:bg-purple-600 transition">
                        <i class="fas fa-star text-2xl mb-2"></i>
                        <p class="font-medium">레벨업</p>
                        <p class="text-sm opacity-90" id="upgradePrice">5,000원</p>
                    </button>
                    <button onclick="earnMoney()" class="bg-yellow-500 text-white p-4 rounded-lg hover:bg-yellow-600 transition">
                        <i class="fas fa-coins text-2xl mb-2"></i>
                        <p class="font-medium">일하기</p>
                        <p class="text-sm opacity-90">수익 획득</p>
                    </button>
                </div>

                <!-- Dodoori Achievements -->
                <div class="bg-gray-50 rounded-lg p-4">
                    <h3 class="font-bold mb-3">업적</h3>
                    <div class="grid grid-cols-2 gap-2 text-sm" id="achievementsList">
                        <!-- Achievements will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200">
        <div class="grid grid-cols-5 h-16">
            <a href="index.html" class="flex flex-col items-center justify-center text-gray-600 hover:text-blue-600">
                <i class="fas fa-home text-xl"></i>
                <span class="text-xs mt-1">홈</span>
            </a>
            <a href="a1.html" class="flex flex-col items-center justify-center text-gray-600 hover:text-blue-600">
                <i class="fas fa-chart-line text-xl"></i>
                <span class="text-xs mt-1">투자</span>
            </a>
            <a href="a2.html" class="flex flex-col items-center justify-center text-gray-600 hover:text-blue-600">
                <i class="fas fa-newspaper text-xl"></i>
                <span class="text-xs mt-1">뉴스</span>
            </a>
            <a href="a4.html" class="flex flex-col items-center justify-center text-blue-600">
                <i class="fas fa-gamepad text-xl"></i>
                <span class="text-xs mt-1">게임</span>
            </a>
            <a href="a3.html" class="flex flex-col items-center justify-center text-gray-600 hover:text-blue-600">
                <i class="fas fa-bars text-xl"></i>
                <span class="text-xs mt-1">더보기</span>
            </a>
        </div>
    </nav>

    <script>
        // User data
        let userData = JSON.parse(localStorage.getItem('fineUserData')) || null;
        let gameData = JSON.parse(localStorage.getItem('fineGameData')) || {
            quizStats: { correct: 0, total: 0, todayCount: 0, points: 0 },
            rocketStats: { bestScore: 0, totalEarnings: 0 },
            dodoori: { level: 1, exp: 0, happiness: 100, hunger: 0, lastFed: Date.now(), birthDate: Date.now() }
        };

        // Quiz data
        const quizQuestions = [
            {
                question: "인플레이션이란 무엇인가요?",
                options: ["물가가 지속적으로 상승하는 현상", "물가가 지속적으로 하락하는 현상", "환율이 상승하는 현상", "금리가 인상되는 현상"],
                correct: 0
            },
            {
                question: "PER(주가수익비율)이 높다는 것은 무엇을 의미하나요?",
                options: ["주식이 저평가되어 있다", "주식이 고평가되어 있을 가능성이 높다", "배당금이 많다", "회사의 매출이 높다"],
                correct: 1
            },
            {
                question: "분산투자의 목적은 무엇인가요?",
                options: ["수익률을 극대화하기 위해", "리스크를 줄이기 위해", "거래 수수료를 줄이기 위해", "세금을 절약하기 위해"],
                correct: 1
            },
            {
                question: "중앙은행이 기준금리를 인상하면 일반적으로 어떤 일이 일어나나요?",
                options: ["주식시장이 상승한다", "부동산 가격이 상승한다", "예금금리가 상승한다", "환율이 하락한다"],
                correct: 2
            },
            {
                question: "ETF(상장지수펀드)의 특징이 아닌 것은?",
                options: ["주식처럼 거래소에서 거래된다", "분산투자 효과가 있다", "운용보수가 일반 펀드보다 낮다", "원금이 보장된다"],
                correct: 3
            }
        ];

        let currentQuizIndex = 0;
        let quizScore = 0;
        let quizTimer = null;
        let timeLeft = 30;
        let selectedAnswer = -1;

        // Rocket game variables
        let rocketMultiplier = 1.0;
        let rocketInterval = null;
        let rocketInvestment = 10000;
        let rocketActive = false;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            if (userData) {
                showGameStats();
                updateDodooriStats();
            }
            setupTabs();
            loadGameData();
        });

        // Setup tabs
        function setupTabs() {
            const tabs = ['quizTab', 'rocketTab', 'dodooriTab'];
            const sections = ['quizSection', 'rocketSection', 'dodooriSection'];

            tabs.forEach((tabId, index) => {
                document.getElementById(tabId).addEventListener('click', () => {
                    tabs.forEach(t => {
                        const tab = document.getElementById(t);
                        tab.className = 'px-6 py-3 text-gray-600 hover:text-blue-600 font-medium';
                    });
                    sections.forEach(s => {
                        document.getElementById(s).classList.add('hidden');
                    });

                    document.getElementById(tabId).className = 'px-6 py-3 text-blue-600 border-b-2 border-blue-600 font-medium';
                    document.getElementById(sections[index]).classList.remove('hidden');
                });
            });
        }

        // Show game stats
        function showGameStats() {
            document.getElementById('gameStatsSection').classList.remove('hidden');
            const totalPoints = gameData.quizStats.points + gameData.rocketStats.totalEarnings;
            const accuracy = gameData.quizStats.total > 0 ? Math.round((gameData.quizStats.correct / gameData.quizStats.total) * 100) : 0;
            
            document.getElementById('totalGamePoints').textContent = totalPoints;
            document.getElementById('quizAccuracy').textContent = `${accuracy}%`;
            document.getElementById('dodooriLevel').textContent = gameData.dodoori.level;
        }

        // Load game data
        function loadGameData() {
            document.getElementById('todayQuizCount').textContent = gameData.quizStats.todayCount;
            document.getElementById('quizPoints').textContent = gameData.quizStats.points;
            document.getElementById('rocketBestScore').textContent = `${gameData.rocketStats.bestScore.toFixed(2)}x`;
            document.getElementById('rocketTotalEarnings').textContent = formatCurrency(gameData.rocketStats.totalEarnings);
        }

        // Quiz functions
        function startQuiz() {
            currentQuizIndex = 0;
            quizScore = 0;
            document.getElementById('quizStart').classList.add('hidden');
            document.getElementById('quizActive').classList.remove('hidden');
            showQuestion();
        }

        function showQuestion() {
            const question = quizQuestions[currentQuizIndex];
            document.getElementById('currentQuestion').textContent = currentQuizIndex + 1;
            document.getElementById('questionText').textContent = question.question;
            
            const optionsContainer = document.getElementById('answerOptions');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'w-full text-left p-3 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 transition';
                button.textContent = option;
                button.onclick = () => selectAnswer(index);
                optionsContainer.appendChild(button);
            });

            updateQuizProgress();
            startTimer();
        }

        function selectAnswer(index) {
            selectedAnswer = index;
            const buttons = document.querySelectorAll('#answerOptions button');
            const question = quizQuestions[currentQuizIndex];
            
            buttons.forEach((btn, i) => {
                btn.disabled = true;
                if (i === question.correct) {
                    btn.className += ' bg-green-100 border-green-500 text-green-700';
                } else if (i === index && i !== question.correct) {
                    btn.className += ' bg-red-100 border-red-500 text-red-700';
                }
            });

            if (index === question.correct) {
                quizScore += 20;
            }

            clearInterval(quizTimer);
            document.getElementById('nextQuestion').classList.remove('hidden');
        }

        function nextQuestion() {
            currentQuizIndex++;
            selectedAnswer = -1;
            document.getElementById('nextQuestion').classList.add('hidden');
            
            if (currentQuizIndex < quizQuestions.length) {
                showQuestion();
            } else {
                endQuiz();
            }
        }

        function startTimer() {
            timeLeft = 30;
            document.getElementById('timeRemaining').textContent = timeLeft;
            
            quizTimer = setInterval(() => {
                timeLeft--;
                document.getElementById('timeRemaining').textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    clearInterval(quizTimer);
                    if (selectedAnswer === -1) {
                        selectAnswer(-1); // No answer selected
                    }
                }
            }, 1000);
        }

        function updateQuizProgress() {
            const progress = ((currentQuizIndex + 1) / quizQuestions.length) * 100;
            document.getElementById('quizProgress').style.width = `${progress}%`;
        }

        function endQuiz() {
            document.getElementById('quizActive').classList.add('hidden');
            document.getElementById('quizResults').classList.remove('hidden');
            
            const accuracy = Math.round((quizScore / 100) * 100);
            document.getElementById('finalScore').textContent = quizScore;
            document.getElementById('finalAccuracy').textContent = accuracy;
            
            // Update game data
            gameData.quizStats.correct += Math.round(quizScore / 20);
            gameData.quizStats.total += quizQuestions.length;
            gameData.quizStats.todayCount += quizQuestions.length;
            gameData.quizStats.points += quizScore;
            
            // Add points to user cash
            if (userData) {
                userData.cash += quizScore * 100; // 100원 per point
                localStorage.setItem('fineUserData', JSON.stringify(userData));
            }
            
            saveGameData();
            loadGameData();
            showGameStats();
        }

        function resetQuiz() {
            document.getElementById('quizResults').classList.add('hidden');
            document.getElementById('quizStart').classList.remove('hidden');
        }

        // Rocket game functions
        function startRocketGame() {
            rocketMultiplier = 1.0;
            rocketActive = true;
            document.getElementById('rocketStart').classList.add('hidden');
            document.getElementById('rocketActive').classList.remove('hidden');
            
            updateRocketDisplay();
            
            rocketInterval = setInterval(() => {
                if (Math.random() < 0.02) { // 2% chance to crash each interval
                    crashRocket();
                } else {
                    rocketMultiplier += 0.01 + (Math.random() * 0.02);
                    updateRocketDisplay();
                }
            }, 100);
        }

        function updateRocketDisplay() {
            const multiplier = rocketMultiplier.toFixed(2);
            const earnings = Math.round(rocketInvestment * rocketMultiplier);
            
            document.getElementById('rocketMultiplier').textContent = `${multiplier}x`;
            document.getElementById('rocketInvestment').textContent = rocketInvestment.toLocaleString();
            document.getElementById('rocketEarnings').textContent = earnings.toLocaleString();
            
            // Animate rocket based on multiplier
            const rocket = document.getElementById('rocketIcon');
            if (rocketMultiplier > 2) {
                rocket.classList.add('flying');
            }
        }

        function cashOut() {
            if (!rocketActive) return;
            
            clearInterval(rocketInterval);
            rocketActive = false;
            
            const earnings = Math.round(rocketInvestment * (rocketMultiplier - 1));
            
            document.getElementById('rocketActive').classList.add('hidden');
            document.getElementById('rocketResult').classList.remove('hidden');
            
            document.getElementById('rocketResultIcon').textContent = '💰';
            document.getElementById('rocketResultText').textContent = '성공적으로 현금화했습니다!';
            document.getElementById('rocketResultEarnings').textContent = `수익: ${formatCurrency(earnings)}`;
            
            // Update stats
            if (rocketMultiplier > gameData.rocketStats.bestScore) {
                gameData.rocketStats.bestScore = rocketMultiplier;
            }
            gameData.rocketStats.totalEarnings += earnings;
            
            // Add earnings to user cash
            if (userData) {
                userData.cash += earnings;
                localStorage.setItem('fineUserData', JSON.stringify(userData));
            }
            
            saveGameData();
            loadGameData();
            showGameStats();
        }

        function crashRocket() {
            clearInterval(rocketInterval);
            rocketActive = false;
            
            document.getElementById('rocketActive').classList.add('hidden');
            document.getElementById('rocketResult').classList.remove('hidden');
            
            document.getElementById('rocketResultIcon').textContent = '💥';
            document.getElementById('rocketResultText').textContent = '로켓이 폭발했습니다!';
            document.getElementById('rocketResultEarnings').textContent = '수익: 0원';
        }

        function resetRocketGame() {
            document.getElementById('rocketResult').classList.add('hidden');
            document.getElementById('rocketStart').classList.remove('hidden');
            document.getElementById('rocketIcon').classList.remove('flying');
        }

        // Dodoori functions
        function updateDodooriStats() {
            const dodoori = gameData.dodoori;
            const now = Date.now();
            const daysSinceBirth = Math.floor((now - dodoori.birthDate) / (1000 * 60 * 60 * 24)) + 1;
            
            // Decrease happiness and increase hunger over time
            const hoursSinceLastFed = (now - dodoori.lastFed) / (1000 * 60 * 60);
            dodoori.hunger = Math.min(100, Math.floor(hoursSinceLastFed * 5));
            dodoori.happiness = Math.max(0, 100 - Math.floor(hoursSinceLastFed * 2));
            
            document.getElementById('dodooriAge').textContent = `태어난 지 ${daysSinceBirth}일`;
            document.getElementById('dodooriLevelText').textContent = dodoori.level;
            document.getElementById('dodooriHappiness').textContent = `${dodoori.happiness}%`;
            document.getElementById('dodooriHunger').textContent = `${dodoori.hunger}%`;
            
            document.getElementById('dodooriLevelProgress').style.width = `${(dodoori.exp % 100)}%`;
            document.getElementById('dodooriHappinessBar').style.width = `${dodoori.happiness}%`;
            document.getElementById('dodooriHungerBar').style.width = `${dodoori.hunger}%`;
            
            const upgradePrice = dodoori.level * 5000;
            document.getElementById('upgradePrice').textContent = `${formatCurrency(upgradePrice)}`;
            
            updateAchievements();
        }

        function feedDodoori() {
            if (!userData || userData.cash < 1000) {
                alert('먹이를 살 돈이 부족합니다!');
                return;
            }
            
            userData.cash -= 1000;
            gameData.dodoori.hunger = Math.max(0, gameData.dodoori.hunger - 30);
            gameData.dodoori.happiness = Math.min(100, gameData.dodoori.happiness + 10);
            gameData.dodoori.lastFed = Date.now();
            gameData.dodoori.exp += 5;
            
            checkLevelUp();
            saveData();
            updateDodooriStats();
        }

        function playWithDodoori() {
            if (!userData || userData.cash < 500) {
                alert('놀이용품을 살 돈이 부족합니다!');
                return;
            }
            
            userData.cash -= 500;
            gameData.dodoori.happiness = Math.min(100, gameData.dodoori.happiness + 15);
            gameData.dodoori.exp += 3;
            
            checkLevelUp();
            saveData();
            updateDodooriStats();
        }

        function upgradeDodoori() {
            const upgradePrice = gameData.dodoori.level * 5000;
            
            if (!userData || userData.cash < upgradePrice) {
                alert('레벨업 비용이 부족합니다!');
                return;
            }
            
            userData.cash -= upgradePrice;
            gameData.dodoori.level++;
            gameData.dodoori.exp = 0;
            
            saveData();
            updateDodooriStats();
            alert(`똑부리가 레벨 ${gameData.dodoori.level}로 성장했습니다!`);
        }

        function earnMoney() {
            const earnings = gameData.dodoori.level * 1000 + Math.floor(Math.random() * 500);
            
            if (userData) {
                userData.cash += earnings;
                gameData.dodoori.exp += 2;
                
                checkLevelUp();
                saveData();
                updateDodooriStats();
                alert(`똑부리가 ${formatCurrency(earnings)}를 벌었습니다!`);
            }
        }

        function checkLevelUp() {
            if (gameData.dodoori.exp >= 100) {
                gameData.dodoori.level++;
                gameData.dodoori.exp = 0;
                alert(`똑부리가 레벨 ${gameData.dodoori.level}로 성장했습니다!`);
            }
        }

        function updateAchievements() {
            const achievements = [
                { name: '첫 먹이', condition: gameData.dodoori.exp > 0 },
                { name: '레벨 5 달성', condition: gameData.dodoori.level >= 5 },
                { name: '행복한 똑부리', condition: gameData.dodoori.happiness >= 90 },
                { name: '퀴즈 마스터', condition: gameData.quizStats.correct >= 20 }
            ];
            
            const achievementsList = document.getElementById('achievementsList');
            achievementsList.innerHTML = '';
            
            achievements.forEach(achievement => {
                const div = document.createElement('div');
                div.className = `p-2 rounded-lg text-center ${achievement.condition ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-500'}`;
                div.innerHTML = `
                    <i class="fas fa-${achievement.condition ? 'trophy' : 'lock'} mb-1"></i>
                    <p class="text-xs">${achievement.name}</p>
                `;
                achievementsList.appendChild(div);
            });
        }

        // Utility functions
        function saveGameData() {
            localStorage.setItem('fineGameData', JSON.stringify(gameData));
        }

        function saveData() {
            localStorage.setItem('fineUserData', JSON.stringify(userData));
            saveGameData();
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('ko-KR', {
                style: 'currency',
                currency: 'KRW'
            }).format(amount);
        }

        // Auto-update dodoori stats every minute
        setInterval(updateDodooriStats, 60000);
    </script>
</body>
</html>