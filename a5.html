<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invest - ëª¨ì˜íˆ¬ì & ê°€ê³„ë¶€</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* í—¤ë” (ê¸°ì¡´ê³¼ ë™ì¼) */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .profile-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .nav-menu {
            background: white;
            padding: 1rem 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .nav-list {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        .nav-list a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        .nav-list a:hover, .nav-list a.active {
            background-color: #667eea;
            color: white;
        }

        /* ë©”ì¸ ì»¨í…ì¸  */
        .main-content {
            padding: 2rem 0;
        }

        .page-header {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .page-title {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: #333;
        }

        .page-subtitle {
            color: #666;
            font-size: 1.1rem;
        }

        /* íƒ­ ë©”ë‰´ */
        .tab-menu {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .tab-buttons {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .tab-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            background: #f8f9fa;
            color: #666;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: #667eea;
            color: white;
        }

        .tab-btn:hover {
            background: #5a6fd8;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* í¬íŠ¸í´ë¦¬ì˜¤ ìš”ì•½ */
        .portfolio-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .summary-card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .summary-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .summary-value.positive {
            color: #28a745;
        }

        .summary-value.negative {
            color: #dc3545;
        }

        .summary-label {
            color: #666;
            font-size: 0.9rem;
        }

        /* íˆ¬ì ìƒí’ˆ ê·¸ë¦¬ë“œ */
        .investment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .investment-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .investment-card:hover {
            transform: translateY(-2px);
        }

        .investment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .investment-name {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .investment-category {
            background: #e9ecef;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            color: #666;
        }

        .investment-price {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .investment-change {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .change-positive {
            color: #28a745;
        }

        .change-negative {
            color: #dc3545;
        }

        .investment-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
            flex: 1;
        }

        .btn-buy {
            background: #28a745;
            color: white;
        }

        .btn-buy:hover {
            background: #218838;
        }

        .btn-sell {
            background: #dc3545;
            color: white;
        }

        .btn-sell:hover {
            background: #c82333;
        }

        /* ê°€ê³„ë¶€ */
        .budget-section {
            margin-top: 2rem;
        }

        .budget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .add-transaction-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
        }

        .transactions-list {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #e9ecef;
        }

        .transaction-item:last-child {
            border-bottom: none;
        }

        .transaction-info {
            flex: 1;
        }

        .transaction-title {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .transaction-category {
            color: #666;
            font-size: 0.9rem;
        }

        .transaction-amount {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .transaction-amount.income {
            color: #28a745;
        }

        .transaction-amount.expense {
            color: #dc3545;
        }

        .transaction-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-small {
            padding: 0.25rem 0.5rem;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .btn-edit {
            background: #ffc107;
            color: #212529;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
        }

        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
        }

        .modal-content {
            background: white;
            margin: 10% auto;
            padding: 2rem;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            position: relative;
        }

        .modal-close {
            position: absolute;
            right: 1rem;
            top: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
        }

        .modal-title {
            margin-bottom: 1.5rem;
            font-size: 1.3rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        /* ë¡œë”© ìƒíƒœ */
        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .tab-buttons {
                flex-wrap: wrap;
            }
            
            .portfolio-summary {
                grid-template-columns: repeat(2, 1fr);
            }

            .investment-grid {
                grid-template-columns: 1fr;
            }

            .transaction-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .transaction-actions {
                align-self: flex-end;
            }
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <h1 class="logo">ğŸ’° Invest</h1>
                <div class="profile-header">
                    <div class="profile-avatar" id="headerAvatar">
                        ğŸ‘¤
                    </div>
                    <span id="headerUserName">íˆ¬ììë‹˜</span>
                </div>
            </div>
        </div>
    </header>

    <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="nav-menu">
        <div class="container">
            <ul class="nav-list">
                <li><a href="index.html">í™ˆ</a></li>
                <li><a href="a2.html">ë‰´ìŠ¤</a></li>
                <li><a href="a3.html">êµìœ¡</a></li>
                <li><a href="a4.html">ì»¤ë®¤ë‹ˆí‹°</a></li>
                <li><a href="a5.html" class="active">íˆ¬ì/ê°€ê³„ë¶€</a></li>
            </ul>
        </div>
    </nav>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="main-content">
        <div class="container">
            <!-- í˜ì´ì§€ í—¤ë” -->
            <section class="page-header">
                <h2 class="page-title">ğŸ“ˆ ëª¨ì˜íˆ¬ì & ê°€ê³„ë¶€</h2>
                <p class="page-subtitle">ì‹¤ì œ ì‹œì¥ ë°ì´í„°ë¡œ ì•ˆì „í•˜ê²Œ íˆ¬ìë¥¼ ì—°ìŠµí•˜ê³  ê°€ê³„ë¶€ë¥¼ ê´€ë¦¬í•˜ì„¸ìš”</p>
            </section>

            <!-- í¬íŠ¸í´ë¦¬ì˜¤ ìš”ì•½ -->
            <section class="portfolio-summary">
                <div class="summary-card">
                    <div class="summary-value" id="totalBalance">â‚©10,000,000</div>
                    <div class="summary-label">ì´ ì”ê³ </div>
                </div>
                <div class="summary-card">
                    <div class="summary-value" id="totalInvestment">â‚©5,000,000</div>
                    <div class="summary-label">íˆ¬ìê¸ˆì•¡</div>
                </div>
                <div class="summary-card">
                    <div class="summary-value positive" id="totalProfit">â‚©250,000</div>
                    <div class="summary-label">í‰ê°€ì†ìµ</div>
                </div>
                <div class="summary-card">
                    <div class="summary-value positive" id="totalReturn">+5.0%</div>
                    <div class="summary-label">ìˆ˜ìµë¥ </div>
                </div>
            </section>

            <!-- íƒ­ ë©”ë‰´ -->
            <section class="tab-menu">
                <div class="tab-buttons">
                    <button class="tab-btn active" data-tab="investment">ëª¨ì˜íˆ¬ì</button>
                    <button class="tab-btn" data-tab="portfolio">ë‚´ í¬íŠ¸í´ë¦¬ì˜¤</button>
                    <button class="tab-btn" data-tab="budget">ê°€ê³„ë¶€</button>
                </div>

                <!-- ëª¨ì˜íˆ¬ì íƒ­ -->
                <div class="tab-content active" id="investment">
                    <div class="loading" id="investmentLoading">
                        <div class="loading-spinner"></div>
                        <p>ì‹¤ì‹œê°„ ì‹œì¥ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                    </div>
                    <div class="investment-grid" id="investmentGrid"></div>
                </div>

                <!-- í¬íŠ¸í´ë¦¬ì˜¤ íƒ­ -->
                <div class="tab-content" id="portfolio">
                    <div class="investment-grid" id="portfolioGrid">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            <p>í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                        </div>
                    </div>
                </div>

                <!-- ê°€ê³„ë¶€ íƒ­ -->
                <div class="tab-content" id="budget">
                    <div class="budget-section">
                        <div class="budget-header">
                            <h3>ê°€ê³„ë¶€ ê´€ë¦¬</h3>
                            <button class="add-transaction-btn" onclick="openTransactionModal()">
                                ê±°ë˜ ì¶”ê°€
                            </button>
                        </div>
                        <div class="transactions-list" id="transactionsList">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                <p>ê±°ë˜ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- ê±°ë˜ ëª¨ë‹¬ -->
    <div class="modal" id="transactionModal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeTransactionModal()">&times;</span>
            <h3 class="modal-title" id="modalTitle">ê±°ë˜ ì¶”ê°€</h3>
            <form id="transactionForm">
                <div class="form-group">
                    <label class="form-label">ê±°ë˜ ìœ í˜•</label>
                    <select class="form-select" id="transactionType" required>
                        <option value="income">ìˆ˜ì…</option>
                        <option value="expense">ì§€ì¶œ</option>
                        <option value="investment">íˆ¬ì</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">ì¹´í…Œê³ ë¦¬</label>
                    <select class="form-select" id="transactionCategory" required>
                        <option value="salary">ê¸‰ì—¬</option>
                        <option value="food">ì‹ë¹„</option>
                        <option value="transport">êµí†µë¹„</option>
                        <option value="shopping">ì‡¼í•‘</option>
                        <option value="investment">íˆ¬ì</option>
                        <option value="other">ê¸°íƒ€</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">ì œëª©</label>
                    <input type="text" class="form-input" id="transactionTitle" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ê¸ˆì•¡</label>
                    <input type="number" class="form-input" id="transactionAmount" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ë‚ ì§œ</label>
                    <input type="date" class="form-input" id="transactionDate" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeTransactionModal()">ì·¨ì†Œ</button>
                    <button type="submit" class="btn btn-primary">ì €ì¥</button>
                </div>
            </form>
        </div>
    </div>

    <!-- íˆ¬ì ëª¨ë‹¬ -->
    <div class="modal" id="investmentModal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeInvestmentModal()">&times;</span>
            <h3 class="modal-title" id="investmentModalTitle">íˆ¬ìí•˜ê¸°</h3>
            <div id="investmentModalContent">
                <div class="form-group">
                    <label class="form-label">ìƒí’ˆëª…</label>
                    <input type="text" class="form-input" id="investmentProduct" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">í˜„ì¬ê°€</label>
                    <input type="text" class="form-input" id="investmentPrice" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">ìˆ˜ëŸ‰/ê¸ˆì•¡</label>
                    <input type="number" class="form-input" id="investmentQuantity" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeInvestmentModal()">ì·¨ì†Œ</button>
                    <button type="button" class="btn btn-buy" id="buyBtn" onclick="executeInvestment('buy')">ë§¤ìˆ˜</button>
                    <button type="button" class="btn btn-sell" id="sellBtn" onclick="executeInvestment('sell')">ë§¤ë„</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ê¸€ë¡œë²Œ ë³€ìˆ˜
        let investmentData = [];
        let portfolioData = [];
        let transactions = [];
        let currentEditingTransaction = null;
        let currentInvestmentProduct = null;

        // í”„ë¡œí•„ ë°ì´í„° ë¡œë“œ
        function loadProfileData() {
            const saved = localStorage.getItem('userProfile');
            if (saved) {
                const profileData = JSON.parse(saved);
                document.getElementById('headerUserName').textContent = profileData.name || 'íˆ¬ììë‹˜';
                const headerAvatar = document.getElementById('headerAvatar');
                if (profileData.profileImage) {
                    headerAvatar.innerHTML = `<img src="${profileData.profileImage}" alt="í”„ë¡œí•„">`;
                } else {
                    headerAvatar.innerHTML = 'ğŸ‘¤';
                }
            }
        }

        // íƒ­ ì´ˆê¸°í™”
        function initTabs() {
            const tabButtons = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const tabId = button.getAttribute('data-tab');
                    
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    button.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                    
                    loadTabContent(tabId);
                });
            });
        }

        // íƒ­ ì»¨í…ì¸  ë¡œë“œ
        function loadTabContent(tabId) {
            switch(tabId) {
                case 'investment':
                    loadInvestmentData();
                    break;
                case 'portfolio':
                    loadPortfolioData();
                    break;
                case 'budget':
                    loadTransactions();
                    break;
            }
        }

        // íˆ¬ì ìƒí’ˆ ë°ì´í„° ë¡œë“œ
        async function loadInvestmentData() {
            const grid = document.getElementById('investmentGrid');
            const loading = document.getElementById('investmentLoading');
            
            loading.style.display = 'block';
            grid.innerHTML = '';

            try {
                // ì‹¤ì œ API í˜¸ì¶œ ì‹œë„
                await Promise.all([
                    fetchStockData(),
                    fetchCryptoData(),
                    fetchBondData(),
                    fetchETFData()
                ]);
            } catch (error) {
                console.log('API í˜¸ì¶œ ì‹¤íŒ¨, ê°€ìƒ ë°ì´í„° ì‚¬ìš©:', error);
                investmentData = generateMockInvestmentData();
            }

            loading.style.display = 'none';
            displayInvestmentData();
        }

        // ê°€ìƒ íˆ¬ì ë°ì´í„° ìƒì„±
        function generateMockInvestmentData() {
            return [
                {
                    name: "ì‚¼ì„±ì „ì",
                    category: "ì£¼ì‹",
                    price: 75400,
                    change: 1200,
                    changePercent: 1.62,
                    symbol: "005930.KS"
                },
                {
                    name: "SKí•˜ì´ë‹‰ìŠ¤",
                    category: "ì£¼ì‹", 
                    price: 142000,
                    change: -2300,
                    changePercent: -1.59,
                    symbol: "000660.KS"
                },
                {
                    name: "ë¹„íŠ¸ì½”ì¸",
                    category: "ì•”í˜¸í™”í",
                    price: 45250000,
                    change: 1250000,
                    changePercent: 2.84,
                    symbol: "BTC"
                },
                {
                    name: "ì´ë”ë¦¬ì›€",
                    category: "ì•”í˜¸í™”í",
                    price: 3850000,
                    change: -125000,
                    changePercent: -3.14,
                    symbol: "ETH"
                },
                {
                    name: "êµ­ê³ ì±„ 10ë…„",
                    category: "ì±„ê¶Œ",
                    price: 102.45,
                    change: 0.15,
                    changePercent: 0.15,
                    symbol: "KR10Y"
                },
                {
                    name: "KODEX 200",
                    category: "ETF",
                    price: 42350,
                    change: 580,
                    changePercent: 1.39,
                    symbol: "069500.KS"
                }
            ];
        }

        // íˆ¬ì ë°ì´í„° í‘œì‹œ
        function displayInvestmentData() {
            const grid = document.getElementById('investmentGrid');
            grid.innerHTML = '';

            investmentData.forEach(product => {
                const card = document.createElement('div');
                card.className = 'investment-card';
                card.innerHTML = `
                    <div class="investment-header">
                        <span class="investment-name">${product.name}</span>
                        <span class="investment-category">${product.category}</span>
                    </div>
                    <div class="investment-price">â‚©${formatNumber(product.price)}</div>
                    <div class="investment-change">
                        <span class="${product.change >= 0 ? 'change-positive' : 'change-negative'}">
                            ${product.change >= 0 ? '+' : ''}â‚©${formatNumber(Math.abs(product.change))}
                        </span>
                        <span class="${product.changePercent >= 0 ? 'change-positive' : 'change-negative'}">
                            (${product.changePercent >= 0 ? '+' : ''}${product.changePercent}%)
                        </span>
                    </div>
                    <div class="investment-actions">
                        <button class="btn btn-buy" onclick="openInvestmentModal('${product.symbol}', 'buy')">ë§¤ìˆ˜</button>
                        <button class="btn btn-sell" onclick="openInvestmentModal('${product.symbol}', 'sell')">ë§¤ë„</button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // í¬íŠ¸í´ë¦¬ì˜¤ ë°ì´í„° ë¡œë“œ
        function loadPortfolioData() {
            const saved = localStorage.getItem('portfolio');
            portfolioData = saved ? JSON.parse(saved) : [];
            displayPortfolioData();
        }

        // í¬íŠ¸í´ë¦¬ì˜¤ ë°ì´í„° í‘œì‹œ
        function displayPortfolioData() {
            const grid = document.getElementById('portfolioGrid');
            grid.innerHTML = '';

            if (portfolioData.length === 0) {
                grid.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem;">ë³´ìœ  ì¤‘ì¸ íˆ¬ì ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            portfolioData.forEach(item => {
                const currentPrice = getCurrentPrice(item.symbol);
                const totalValue = currentPrice * item.quantity;
                const profit = totalValue - item.totalCost;
                const profitPercent = (profit / item.totalCost) * 100;

                const card = document.createElement('div');
                card.className = 'investment-card';
                card.innerHTML = `
                    <div class="investment-header">
                        <span class="investment-name">${item.name}</span>
                        <span class="investment-category">${item.category}</span>
                    </div>
                    <div class="investment-price">â‚©${formatNumber(currentPrice)}</div>
                    <div class="investment-change">
                        <span class="${profit >= 0 ? 'change-positive' : 'change-negative'}">
                            ${profit >= 0 ? '+' : ''}â‚©${formatNumber(Math.abs(profit))}
                        </span>
                        <span class="${profitPercent >= 0 ? 'change-positive' : 'change-negative'}">
                            (${profitPercent >= 0 ? '+' : ''}${profitPercent.toFixed(2)}%)
                        </span>
                    </div>
                    <div style="margin: 1rem 0; font-size: 0.9rem; color: #666;">
                        ë³´ìœ ìˆ˜ëŸ‰: ${formatNumber(item.quantity)}ì£¼<br>
                        í‰ê· ë‹¨ê°€: â‚©${formatNumber(item.averagePrice)}<br>
                        í‰ê°€ê¸ˆì•¡: â‚©${formatNumber(totalValue)}
                    </div>
                    <div class="investment-actions">
                        <button class="btn btn-buy" onclick="openInvestmentModal('${item.symbol}', 'buy')">ì¶”ê°€ë§¤ìˆ˜</button>
                        <button class="btn btn-sell" onclick="openInvestmentModal('${item.symbol}', 'sell')">ë§¤ë„</button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // ê±°ë˜ë‚´ì—­ ë¡œë“œ
        function loadTransactions() {
            const saved = localStorage.getItem('transactions');
            transactions = saved ? JSON.parse(saved) : generateMockTransactions();
            displayTransactions();
        }

        // ê°€ìƒ ê±°ë˜ë‚´ì—­ ìƒì„±
        function generateMockTransactions() {
            return [
                {
                    id: 1,
                    type: 'income',
                    category: 'salary',
                    title: 'ì›”ê¸‰',
                    amount: 3000000,
                    date: '2024-01-01'
                },
                {
                    id: 2,
                    type: 'expense',
                    category: 'food',
                    title: 'ì‹ë¹„',
                    amount: 150000,
                    date: '2024-01-05'
                },
                {
                    id: 3,
                    type: 'investment',
                    category: 'investment',
                    title: 'ì‚¼ì„±ì „ì ë§¤ìˆ˜',
                    amount: 1000000,
                    date: '2024-01-10'
                }
            ];
        }

        // ê±°ë˜ë‚´ì—­ í‘œì‹œ
        function displayTransactions() {
            const list = document.getElementById('transactionsList');
            list.innerHTML = '';

            if (transactions.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem;">ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            transactions.forEach(transaction => {
                const item = document.createElement('div');
                item.className = 'transaction-item';
                item.innerHTML = `
                    <div class="transaction-info">
                        <div class="transaction-title">${transaction.title}</div>
                        <div class="transaction-category">${getCategoryName(transaction.category)} â€¢ ${transaction.date}</div>
                    </div>
                    <div class="transaction-amount ${transaction.type}">
                        ${transaction.type === 'income' ? '+' : '-'}â‚©${formatNumber(transaction.amount)}
                    </div>
                    <div class="transaction-actions">
                        <button class="btn-small btn-edit" onclick="editTransaction(${transaction.id})">ìˆ˜ì •</button>
                        <button class="btn-small btn-delete" onclick="deleteTransaction(${transaction.id})">ì‚­ì œ</button>
                    </div>
                `;
                list.appendChild(item);
            });
        }

        // íˆ¬ì ëª¨ë‹¬ ì—´ê¸°
        function openInvestmentModal(symbol, action) {
            const product = investmentData.find(p => p.symbol === symbol) || 
                           portfolioData.find(p => p.symbol === symbol);
            if (!product) return;

            currentInvestmentProduct = product;
            document.getElementById('investmentProduct').value = product.name;
            document.getElementById('investmentPrice').value = `â‚©${formatNumber(product.price || getCurrentPrice(symbol))}`;
            document.getElementById('investmentQuantity').value = '';
            
            const modal = document.getElementById('investmentModal');
            const title = document.getElementById('investmentModalTitle');
            const buyBtn = document.getElementById('buyBtn');
            const sellBtn = document.getElementById('sellBtn');
            
            if (action === 'buy') {
                title.textContent = `${product.name} ë§¤ìˆ˜`;
                buyBtn.style.display = 'block';
                sellBtn.style.display = 'none';
            } else {
                title.textContent = `${product.name} ë§¤ë„`;
                buyBtn.style.display = 'none';
                sellBtn.style.display = 'block';
            }
            
            modal.style.display = 'block';
        }

        // íˆ¬ì ëª¨ë‹¬ ë‹«ê¸°
        function closeInvestmentModal() {
            document.getElementById('investmentModal').style.display = 'none';
        }

        // íˆ¬ì ì‹¤í–‰
        function executeInvestment(action) {
            const quantity = parseInt(document.getElementById('investmentQuantity').value);
            if (!quantity || quantity <= 0) {
                alert('ì˜¬ë°”ë¥¸ ìˆ˜ëŸ‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const product = currentInvestmentProduct;
            const price = product.price || getCurrentPrice(product.symbol);
            const totalAmount = price * quantity;

            if (action === 'buy') {
                // ë§¤ìˆ˜ ì²˜ë¦¬
                buyInvestment(product, quantity, price);
                addTransaction({
                    type: 'investment',
                    category: 'investment',
                    title: `${product.name} ë§¤ìˆ˜`,
                    amount: totalAmount,
                    date: new Date().toISOString().split('T')[0]
                });
            } else {
                // ë§¤ë„ ì²˜ë¦¬
                if (sellInvestment(product, quantity, price)) {
                    addTransaction({
                        type: 'income',
                        category: 'investment',
                        title: `${product.name} ë§¤ë„`,
                        amount: totalAmount,
                        date: new Date().toISOString().split('T')[0]
                    });
                } else {
                    alert('ë³´ìœ  ìˆ˜ëŸ‰ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.');
                    return;
                }
            }

            closeInvestmentModal();
            updatePortfolioSummary();
            loadPortfolioData();
            alert(`${action === 'buy' ? 'ë§¤ìˆ˜' : 'ë§¤ë„'}ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }

        // ë§¤ìˆ˜ ì²˜ë¦¬
        function buyInvestment(product, quantity, price) {
            const existing = portfolioData.find(p => p.symbol === product.symbol);
            if (existing) {
                const totalCost = existing.totalCost + (price * quantity);
                const totalQuantity = existing.quantity + quantity;
                existing.averagePrice = totalCost / totalQuantity;
                existing.quantity = totalQuantity;
                existing.totalCost = totalCost;
            } else {
                portfolioData.push({
                    symbol: product.symbol,
                    name: product.name,
                    category: product.category,
                    quantity: quantity,
                    averagePrice: price,
                    totalCost: price * quantity
                });
            }
            localStorage.setItem('portfolio', JSON.stringify(portfolioData));
        }

        // ë§¤ë„ ì²˜ë¦¬
        function sellInvestment(product, quantity, price) {
            const existing = portfolioData.find(p => p.symbol === product.symbol);
            if (!existing || existing.quantity < quantity) {
                return false;
            }

            existing.quantity -= quantity;
            existing.totalCost -= existing.averagePrice * quantity;

            if (existing.quantity === 0) {
                portfolioData = portfolioData.filter(p => p.symbol !== product.symbol);
            }

            localStorage.setItem('portfolio', JSON.stringify(portfolioData));
            return true;
        }

        // ê±°ë˜ ì¶”ê°€ ëª¨ë‹¬ ì—´ê¸°
        function openTransactionModal(transaction = null) {
            const modal = document.getElementById('transactionModal');
            const title = document.getElementById('modalTitle');
            const form = document.getElementById('transactionForm');

            if (transaction) {
                title.textContent = 'ê±°ë˜ ìˆ˜ì •';
                document.getElementById('transactionType').value = transaction.type;
                document.getElementById('transactionCategory').value = transaction.category;
                document.getElementById('transactionTitle').value = transaction.title;
                document.getElementById('transactionAmount').value = transaction.amount;
                document.getElementById('transactionDate').value = transaction.date;
                currentEditingTransaction = transaction;
            } else {
                title.textContent = 'ê±°ë˜ ì¶”ê°€';
                form.reset();
                document.getElementById('transactionDate').value = new Date().toISOString().split('T')[0];
                currentEditingTransaction = null;
            }

            modal.style.display = 'block';
        }

        // ê±°ë˜ ëª¨ë‹¬ ë‹«ê¸°
        function closeTransactionModal() {
            document.getElementById('transactionModal').style.display = 'none';
        }

        // ê±°ë˜ ì¶”ê°€/ìˆ˜ì •
        function addTransaction(transactionData) {
            if (currentEditingTransaction) {
                const index = transactions.findIndex(t => t.id === currentEditingTransaction.id);
                transactions[index] = { ...transactionData, id: currentEditingTransaction.id };
            } else {
                const id = transactions.length > 0 ? Math.max(...transactions.map(t => t.id)) + 1 : 1;
                transactions.push({ ...transactionData, id });
            }
            
            localStorage.setItem('transactions', JSON.stringify(transactions));
            displayTransactions();
        }

        // ê±°ë˜ ìˆ˜ì •
        function editTransaction(id) {
            const transaction = transactions.find(t => t.id === id);
            if (transaction) {
                openTransactionModal(transaction);
            }
        }

        // ê±°ë˜ ì‚­ì œ
        function deleteTransaction(id) {
            if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                transactions = transactions.filter(t => t.id !== id);
                localStorage.setItem('transactions', JSON.stringify(transactions));
                displayTransactions();
            }
        }

        // í¬íŠ¸í´ë¦¬ì˜¤ ìš”ì•½ ì—…ë°ì´íŠ¸
        function updatePortfolioSummary() {
            let totalBalance = 10000000; // ì´ˆê¸° ì”ê³ 
            let totalInvestment = 0;
            let totalCurrentValue = 0;

            portfolioData.forEach(item => {
                const currentPrice = getCurrentPrice(item.symbol);
                const currentValue = currentPrice * item.quantity;
                totalInvestment += item.totalCost;
                totalCurrentValue += currentValue;
            });

            const totalProfit = totalCurrentValue - totalInvestment;
            const totalReturn = totalInvestment > 0 ? (totalProfit / totalInvestment) * 100 : 0;

            document.getElementById('totalBalance').textContent = `â‚©${formatNumber(totalBalance)}`;
            document.getElementById('totalInvestment').textContent = `â‚©${formatNumber(totalInvestment)}`;
            document.getElementById('totalProfit').textContent = `â‚©${formatNumber(Math.abs(totalProfit))}`;
            document.getElementById('totalReturn').textContent = `${totalReturn >= 0 ? '+' : ''}${totalReturn.toFixed(2)}%`;

            // ìƒ‰ìƒ ì—…ë°ì´íŠ¸
            const profitElement = document.getElementById('totalProfit');
            const returnElement = document.getElementById('totalReturn');
            if (totalProfit >= 0) {
                profitElement.className = 'summary-value positive';
                returnElement.className = 'summary-value positive';
            } else {
                profitElement.className = 'summary-value negative';
                returnElement.className = 'summary-value negative';
            }
        }

        // í˜„ì¬ ê°€ê²© ì¡°íšŒ
        function getCurrentPrice(symbol) {
            const product = investmentData.find(p => p.symbol === symbol);
            return product ? product.price : 0;
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function formatNumber(num) {
            return new Intl.NumberFormat('ko-KR').format(num);
        }

        function getCategoryName(category) {
            const categories = {
                salary: 'ê¸‰ì—¬',
                food: 'ì‹ë¹„',
                transport: 'êµí†µë¹„',
                shopping: 'ì‡¼í•‘',
                investment: 'íˆ¬ì',
                other: 'ê¸°íƒ€'
            };
            return categories[category] || category;
        }

        // ì‹¤ì œ API í˜¸ì¶œ í•¨ìˆ˜ë“¤ (í˜„ì¬ëŠ” ë¹ˆ í•¨ìˆ˜, ì‹¤ì œ êµ¬í˜„ì‹œ ì±„ì›Œë„£ê¸°)
        async function fetchStockData() {
            // Yahoo Finance API í˜¸ì¶œ
            throw new Error('API not implemented');
        }

        async function fetchCryptoData() {
            // CoinGecko API í˜¸ì¶œ
            throw new Error('API not implemented');
        }

        async function fetchBondData() {
            // í•œêµ­ì€í–‰ API í˜¸ì¶œ
            throw new Error('API not implemented');
        }

        async function fetchETFData() {
            // Yahoo Finance API í˜¸ì¶œ
            throw new Error('API not implemented');
        }

        // í¼ ì œì¶œ ì²˜ë¦¬
        document.getElementById('transactionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                type: document.getElementById('transactionType').value,
                category: document.getElementById('transactionCategory').value,
                title: document.getElementById('transactionTitle').value,
                amount: parseInt(document.getElementById('transactionAmount').value),
                date: document.getElementById('transactionDate').value
            };

            addTransaction(formData);
            closeTransactionModal();
        });

        // í˜ì´ì§€ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            loadProfileData();
            initTabs();
            loadInvestmentData();
            updatePortfolioSummary();

            // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
            window.addEventListener('click', function(e) {
                const transactionModal = document.getElementById('transactionModal');
                const investmentModal = document.getElementById('investmentModal');
                
                if (e.target === transactionModal) {
                    closeTransactionModal();
                }
                if (e.target === investmentModal) {
                    closeInvestmentModal();
                }
            });
        });
    </script>
</body>
</html>