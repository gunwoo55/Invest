<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>등급 메뉴 - FINE U</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .grade-bronze { background: linear-gradient(135deg, #CD7F32, #B8860B); }
        .grade-silver { background: linear-gradient(135deg, #C0C0C0, #A8A8A8); }
        .grade-gold { background: linear-gradient(135deg, #FFD700, #FFA500); }
        .grade-platinum { background: linear-gradient(135deg, #E5E4E2, #BCC6CC); }
        .grade-diamond { background: linear-gradient(135deg, #B9F2FF, #00BFFF); }
    </style>
</head>
<body class="bg-gray-50 min-h-screen pb-20">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center">
                <button onclick="history.back()" class="mr-4">
                    <i class="fas fa-arrow-left text-xl"></i>
                </button>
                <h1 class="text-xl font-bold">등급 메뉴</h1>
            </div>
        </div>
    </header>

    <!-- User Grade Banner -->
    <div id="gradeBanner" class="p-6 text-white">
        <div class="text-center">
            <div class="w-24 h-24 rounded-full mx-auto mb-4 flex items-center justify-center" id="gradeIcon">
                <i class="fas fa-crown text-4xl"></i>
            </div>
            <h2 class="text-2xl font-bold mb-2" id="currentGrade">브론즈 등급</h2>
            <p class="text-sm opacity-90 mb-4" id="gradeDescription">기본 투자 상품을 이용할 수 있습니다</p>
            <div class="bg-white bg-opacity-20 rounded-lg p-3">
                <p class="text-sm mb-1">다음 등급까지</p>
                <div class="w-full bg-white bg-opacity-30 rounded-full h-2 mb-2">
                    <div class="bg-white h-2 rounded-full" id="gradeProgress"></div>
                </div>
                <p class="text-xs" id="progressText">실버 등급까지 500만원 필요</p>
            </div>
        </div>
    </div>

    <!-- Tab Navigation -->
    <div class="bg-white border-b">
        <div class="container mx-auto px-4">
            <div class="flex">
                <button id="householdTab" class="px-6 py-3 text-blue-600 border-b-2 border-blue-600 font-medium">
                    가계부
                </button>
                <button id="assetTab" class="px-6 py-3 text-gray-600 hover:text-blue-600 font-medium">
                    자산운용
                </button>
                <button id="gradeProductTab" class="px-6 py-3 text-gray-600 hover:text-blue-600 font-medium">
                    등급별 상품
                </button>
            </div>
        </div>
    </div>

    <!-- Content -->
    <main class="container mx-auto px-4 py-6">
        <!-- Household Book Section -->
        <div id="householdSection">
            <!-- Monthly Summary -->
            <div class="bg-white rounded-lg card-shadow p-6 mb-6">
                <h2 class="text-lg font-bold mb-4 flex items-center">
                    <i class="fas fa-calendar-alt text-blue-500 mr-2"></i>
                    이번 달 요약
                </h2>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="text-center p-4 bg-green-50 rounded-lg">
                        <p class="text-sm text-gray-600">총 수입</p>
                        <p class="text-2xl font-bold text-green-600" id="monthlyIncome">0</p>
                    </div>
                    <div class="text-center p-4 bg-red-50 rounded-lg">
                        <p class="text-sm text-gray-600">총 지출</p>
                        <p class="text-2xl font-bold text-red-600" id="monthlyExpense">0</p>
                    </div>
                </div>
                <div class="text-center p-4 bg-blue-50 rounded-lg">
                    <p class="text-sm text-gray-600">순 자산 변화</p>
                    <p class="text-xl font-bold" id="netChange">0</p>
                </div>
            </div>

            <!-- Add Transaction -->
            <div class="bg-white rounded-lg card-shadow p-6 mb-6">
                <h2 class="text-lg font-bold mb-4 flex items-center">
                    <i class="fas fa-plus-circle text-green-500 mr-2"></i>
                    거래 추가
                </h2>
                <form id="transactionForm" class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">구분</label>
                            <select id="transactionType" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                                <option value="income">수입</option>
                                <option value="expense">지출</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">카테고리</label>
                            <select id="transactionCategory" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                                <!-- Options will be populated by JavaScript -->
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">금액</label>
                        <input type="number" id="transactionAmount" min="0" step="1000" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" placeholder="금액을 입력하세요">
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">메모</label>
                        <input type="text" id="transactionMemo" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" placeholder="메모 (선택사항)">
                    </div>
                    <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition">
                        추가하기
                    </button>
                </form>
            </div>

            <!-- Transaction History -->
            <div class="bg-white rounded-lg card-shadow p-6 mb-6">
                <h2 class="text-lg font-bold mb-4 flex items-center">
                    <i class="fas fa-history text-purple-500 mr-2"></i>
                    거래 내역
                </h2>
                <div id="transactionHistory" class="space-y-3">
                    <!-- Transaction history will be populated by JavaScript -->
                </div>
            </div>

            <!-- Expense Chart -->
            <div class="bg-white rounded-lg card-shadow p-6">
                <h2 class="text-lg font-bold mb-4 flex items-center">
                    <i class="fas fa-chart-pie text-orange-500 mr-2"></i>
                    지출 분석
                </h2>
                <div class="h-64">
                    <canvas id="expenseChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Asset Management Section -->
        <div id="assetSection" class="hidden">
            <!-- Asset Allocation -->
            <div class="bg-white rounded-lg card-shadow p-6 mb-6">
                <h2 class="text-lg font-bold mb-4 flex items-center">
                    <i class="fas fa-chart-pie text-blue-500 mr-2"></i>
                    자산 배분
                </h2>
                <div class="h-64 mb-4">
                    <canvas id="assetChart"></canvas>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="text-center p-4 bg-gray-50 rounded-lg">
                        <p class="text-sm text-gray-600">총 자산</p>
                        <p class="text-xl font-bold text-blue-600" id="totalAssetValue">0</p>
                    </div>
                    <div class="text-center p-4 bg-gray-50 rounded-lg">
                        <p class="text-sm text-gray-600">수익률</p>
                        <p class="text-xl font-bold" id="totalReturnRate">0%</p>
                    </div>
                </div>
            </div>

            <!-- Asset Details -->
            <div class="bg-white rounded-lg card-shadow p-6 mb-6">
                <h2 class="text-lg font-bold mb-4 flex items-center">
                    <i class="fas fa-list text-green-500 mr-2"></i>
                    자산 상세
                </h2>
                <div class="space-y-3" id="assetDetails">
                    <!-- Asset details will be populated by JavaScript -->
                </div>
            </div>

            <!-- Rebalancing Suggestion -->
            <div class="bg-white rounded-lg card-shadow p-6 mb-6">
                <h2 class="text-lg font-bold mb-4 flex items-center">
                    <i class="fas fa-balance-scale text-purple-500 mr-2"></i>
                    리밸런싱 제안
                </h2>
                <div id="rebalancingSuggestion" class="space-y-3">
                    <!-- Rebalancing suggestions will be populated by JavaScript -->
                </div>
            </div>

            <!-- Goal Setting -->
            <div class="bg-white rounded-lg card-shadow p-6">
                <h2 class="text-lg font-bold mb-4 flex items-center">
                    <i class="fas fa-target text-orange-500 mr-2"></i>
                    목표 설정
                </h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">목표 금액</label>
                        <input type="number" id="goalAmount" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" placeholder="목표 금액을 설정하세요">
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">목표 기간 (개월)</label>
                        <input type="number" id="goalPeriod" min="1" max="120" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" placeholder="목표 달성 기간">
                    </div>
                    <button onclick="setGoal()" class="w-full bg-orange-600 text-white py-2 rounded-lg hover:bg-orange-700 transition">
                        목표 설정
                    </button>
                    <div id="goalProgress" class="hidden bg-orange-50 p-4 rounded-lg">
                        <!-- Goal progress will be shown here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Grade-based Products Section -->
        <div id="gradeProductSection" class="hidden">
            <!-- Current Grade Benefits -->
            <div class="bg-white rounded-lg card-shadow p-6 mb-6">
                <h2 class="text-lg font-bold mb-4 flex items-center">
                    <i class="fas fa-gift text-blue-500 mr-2"></i>
                    현재 등급 혜택
                </h2>
                <div id="currentGradeBenefits" class="space-y-3">
                    <!-- Current grade benefits will be populated by JavaScript -->
                </div>
            </div>

            <!-- Grade Requirements -->
            <div class="bg-white rounded-lg card-shadow p-6 mb-6">
                <h2 class="text-lg font-bold mb-4 flex items-center">
                    <i class="fas fa-stairs text-green-500 mr-2"></i>
                    등급별 요구사항
                </h2>
                <div class="space-y-4" id="gradeRequirements">
                    <!-- Grade requirements will be populated by JavaScript -->
                </div>
            </div>

            <!-- Premium Products by Grade -->
            <div class="bg-white rounded-lg card-shadow p-6 mb-6">
                <h2 class="text-lg font-bold mb-4 flex items-center">
                    <i class="fas fa-star text-yellow-500 mr-2"></i>
                    등급별 특별 상품
                </h2>
                <div class="space-y-4" id="premiumProducts">
                    <!-- Premium products will be populated by JavaScript -->
                </div>
            </div>

            <!-- Grade Upgrade Simulator -->
            <div class="bg-white rounded-lg card-shadow p-6">
                <h2 class="text-lg font-bold mb-4 flex items-center">
                    <i class="fas fa-calculator text-purple-500 mr-2"></i>
                    등급 상승 시뮬레이터
                </h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">목표 등급</label>
                        <select id="targetGrade" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                            <option value="silver">실버</option>
                            <option value="gold">골드</option>
                            <option value="platinum">플래티넘</option>
                            <option value="diamond">다이아몬드</option>
                        </select>
                    </div>
                    <button onclick="simulateGradeUpgrade()" class="w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700 transition">
                        시뮬레이션 실행
                    </button>
                    <div id="simulationResult" class="hidden bg-purple-50 p-4 rounded-lg">
                        <!-- Simulation result will be shown here -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200">
        <div class="grid grid-cols-5 h-16">
            <a href="index.html" class="flex flex-col items-center justify-center text-gray-600 hover:text-blue-600">
                <i class="fas fa-home text-xl"></i>
                <span class="text-xs mt-1">홈</span>
            </a>
            <a href="a1.html" class="flex flex-col items-center justify-center text-gray-600 hover:text-blue-600">
                <i class="fas fa-chart-line text-xl"></i>
                <span class="text-xs mt-1">투자</span>
            </a>
            <a href="a2.html" class="flex flex-col items-center justify-center text-gray-600 hover:text-blue-600">
                <i class="fas fa-newspaper text-xl"></i>
                <span class="text-xs mt-1">뉴스</span>
            </a>
            <a href="a4.html" class="flex flex-col items-center justify-center text-gray-600 hover:text-blue-600">
                <i class="fas fa-gamepad text-xl"></i>
                <span class="text-xs mt-1">게임</span>
            </a>
            <a href="a3.html" class="flex flex-col items-center justify-center text-blue-600">
                <i class="fas fa-bars text-xl"></i>
                <span class="text-xs mt-1">더보기</span>
            </a>
        </div>
    </nav>

    <script>
        // User data
        let userData = JSON.parse(localStorage.getItem('fineUserData')) || null;
        let householdData = JSON.parse(localStorage.getItem('fineHouseholdData')) || {
            transactions: [],
            goals: []
        };

        // Charts
        let expenseChart = null;
        let assetChart = null;

        // Categories
        const incomeCategories = ['급여', '투자수익', '기타수입'];
        const expenseCategories = ['식비', '교통비', '문화생활', '쇼핑', '투자', '기타지출'];

        // Grade thresholds
        const gradeThresholds = {
            bronze: 0,
            silver: 10000000,
            gold: 20000000,
            platinum: 50000000,
            diamond: 100000000
        };

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            if (!userData) {
                alert('로그인이 필요합니다.');
                location.href = 'index.html';
                return;
            }
            
            setupTabs();
            updateGradeBanner();
            loadHouseholdData();
            updateAssetManagement();
            updateGradeProducts();
            populateCategoryOptions();
        });

        // Setup tabs
        function setupTabs() {
            const tabs = ['householdTab', 'assetTab', 'gradeProductTab'];
            const sections = ['householdSection', 'assetSection', 'gradeProductSection'];

            tabs.forEach((tabId, index) => {
                document.getElementById(tabId).addEventListener('click', () => {
                    tabs.forEach(t => {
                        const tab = document.getElementById(t);
                        tab.className = 'px-6 py-3 text-gray-600 hover:text-blue-600 font-medium';
                    });
                    sections.forEach(s => {
                        document.getElementById(s).classList.add('hidden');
                    });

                    document.getElementById(tabId).className = 'px-6 py-3 text-blue-600 border-b-2 border-blue-600 font-medium';
                    document.getElementById(sections[index]).classList.remove('hidden');
                    
                    // Load specific data when tab is activated
                    if (index === 1) updateAssetManagement();
                    if (index === 2) updateGradeProducts();
                });
            });
        }

        // Update grade banner
        function updateGradeBanner() {
            const totalAssets = userData.cash + userData.stocks + userData.crypto + userData.bonds + userData.etf + userData.savings + userData.preciousMetals;
            let currentGrade = 'bronze';
            let gradeClass = 'grade-bronze';
            let gradeName = '브론즈';
            let gradeDescription = '기본 투자 상품을 이용할 수 있습니다';
            
            if (totalAssets >= gradeThresholds.diamond) {
                currentGrade = 'diamond';
                gradeClass = 'grade-diamond';
                gradeName = '다이아몬드';
                gradeDescription = '모든 프리미엄 상품과 VIP 서비스를 이용할 수 있습니다';
            } else if (totalAssets >= gradeThresholds.platinum) {
                currentGrade = 'platinum';
                gradeClass = 'grade-platinum';
                gradeName = '플래티넘';
                gradeDescription = '고급 투자 상품과 전문 컨설팅을 이용할 수 있습니다';
            } else if (totalAssets >= gradeThresholds.gold) {
                currentGrade = 'gold';
                gradeClass = 'grade-gold';
                gradeName = '골드';
                gradeDescription = '귀금속 투자와 해외 상품을 이용할 수 있습니다';
            } else if (totalAssets >= gradeThresholds.silver) {
                currentGrade = 'silver';
                gradeClass = 'grade-silver';
                gradeName = '실버';
                gradeDescription = 'ETF와 채권 투자를 이용할 수 있습니다';
            }

            const gradeBanner = document.getElementById('gradeBanner');
            gradeBanner.className = `p-6 text-white ${gradeClass}`;
            
            document.getElementById('currentGrade').textContent = `${gradeName} 등급`;
            document.getElementById('gradeDescription').textContent = gradeDescription;
            
            // Calculate progress to next grade
            const gradeKeys = Object.keys(gradeThresholds);
            const currentIndex = gradeKeys.indexOf(currentGrade);
            
            if (currentIndex < gradeKeys.length - 1) {
                const nextGrade = gradeKeys[currentIndex + 1];
                const nextThreshold = gradeThresholds[nextGrade];
                const currentThreshold = gradeThresholds[currentGrade];
                const progress = ((totalAssets - currentThreshold) / (nextThreshold - currentThreshold)) * 100;
                const remaining = nextThreshold - totalAssets;
                
                document.getElementById('gradeProgress').style.width = `${Math.min(progress, 100)}%`;
                document.getElementById('progressText').textContent = `${getGradeName(nextGrade)} 등급까지 ${formatCurrency(remaining)} 필요`;
            } else {
                document.getElementById('gradeProgress').style.width = '100%';
                document.getElementById('progressText').textContent = '최고 등급 달성!';
            }
        }

        // Populate category options
        function populateCategoryOptions() {
            const categorySelect = document.getElementById('transactionCategory');
            const typeSelect = document.getElementById('transactionType');
            
            function updateCategories() {
                const type = typeSelect.value;
                const categories = type === 'income' ? incomeCategories : expenseCategories;
                
                categorySelect.innerHTML = '';
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    categorySelect.appendChild(option);
                });
            }
            
            updateCategories();
            typeSelect.addEventListener('change', updateCategories);
        }

        // Load household data
        function loadHouseholdData() {
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            // Filter transactions for current month
            const monthlyTransactions = householdData.transactions.filter(t => {
                const date = new Date(t.date);
                return date.getMonth() === currentMonth && date.getFullYear() === currentYear;
            });
            
            const monthlyIncome = monthlyTransactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
                
            const monthlyExpense = monthlyTransactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
                
            const netChange = monthlyIncome - monthlyExpense;
            
            document.getElementById('monthlyIncome').textContent = formatCurrency(monthlyIncome);
            document.getElementById('monthlyExpense').textContent = formatCurrency(monthlyExpense);
            document.getElementById('netChange').textContent = formatCurrency(netChange);
            document.getElementById('netChange').className = `text-xl font-bold ${netChange >= 0 ? 'text-green-600' : 'text-red-600'}`;
            
            displayTransactionHistory();
            createExpenseChart(monthlyTransactions);
        }

        // Add transaction
        document.getElementById('transactionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const type = document.getElementById('transactionType').value;
            const category = document.getElementById('transactionCategory').value;
            const amount = parseInt(document.getElementById('transactionAmount').value);
            const memo = document.getElementById('transactionMemo').value;
            
            if (!amount || amount <= 0) {
                alert('올바른 금액을 입력하세요.');
                return;
            }
            
            const transaction = {
                id: Date.now(),
                type: type,
                category: category,
                amount: amount,
                memo: memo,
                date: new Date().toISOString()
            };
            
            householdData.transactions.push(transaction);
            
            // Update user cash based on transaction
            if (type === 'income') {
                userData.cash += amount;
            } else {
                if (userData.cash >= amount) {
                    userData.cash -= amount;
                } else {
                    alert('현금이 부족합니다.');
                    return;
                }
            }
            
            saveData();
            loadHouseholdData();
            
            // Reset form
            document.getElementById('transactionForm').reset();
            populateCategoryOptions();
        });

        // Display transaction history
        function displayTransactionHistory() {
            const historyContainer = document.getElementById('transactionHistory');
            const recentTransactions = householdData.transactions
                .slice(-10)
                .reverse();
                
            if (recentTransactions.length === 0) {
                historyContainer.innerHTML = '<div class="text-center text-gray-500 py-8">거래 내역이 없습니다.</div>';
                return;
            }
            
            historyContainer.innerHTML = recentTransactions.map(transaction => `
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                    <div>
                        <p class="font-medium">${transaction.category}</p>
                        <p class="text-sm text-gray-600">${transaction.memo || '메모 없음'}</p>
                        <p class="text-xs text-gray-500">${new Date(transaction.date).toLocaleDateString()}</p>
                    </div>
                    <div class="text-right">
                        <p class="font-bold ${transaction.type === 'income' ? 'text-green-600' : 'text-red-600'}">
                            ${transaction.type === 'income' ? '+' : '-'}${formatCurrency(transaction.amount)}
                        </p>
                    </div>
                </div>
            `).join('');
        }

        // Create expense chart
        function createExpenseChart(transactions) {
            const ctx = document.getElementById('expenseChart').getContext('2d');
            
            if (expenseChart) {
                expenseChart.destroy();
            }
            
            const expensesByCategory = {};
            transactions
                .filter(t => t.type === 'expense')
                .forEach(t => {
                    expensesByCategory[t.category] = (expensesByCategory[t.category] || 0) + t.amount;
                });
            
            const labels = Object.keys(expensesByCategory);
            const data = Object.values(expensesByCategory);
            
            if (labels.length === 0) {
                ctx.font = '16px Arial';
                ctx.fillStyle = '#9CA3AF';
                ctx.textAlign = 'center';
                ctx.fillText('지출 내역이 없습니다', ctx.canvas.width / 2, ctx.canvas.height / 2);
                return;
            }
            
            expenseChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            '#EF4444', '#F59E0B', '#10B981', '#3B82F6',
                            '#8B5CF6', '#EC4899', '#6B7280', '#F97316'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Update asset management
        function updateAssetManagement() {
            const totalAssets = userData.cash + userData.stocks + userData.crypto + userData.bonds + userData.etf + userData.savings + userData.preciousMetals;
            const returnRate = ((totalAssets - userData.initialFunds) / userData.initialFunds * 100).toFixed(2);
            
            document.getElementById('totalAssetValue').textContent = formatCurrency(totalAssets);
            document.getElementById('totalReturnRate').textContent = `${returnRate}%`;
            document.getElementById('totalReturnRate').className = `text-xl font-bold ${returnRate >= 0 ? 'text-green-600' : 'text-red-600'}`;
            
            createAssetChart();
            displayAssetDetails();
            generateRebalancingSuggestion();
        }

        // Create asset chart
        function createAssetChart() {
            const ctx = document.getElementById('assetChart').getContext('2d');
            
            if (assetChart) {
                assetChart.destroy();
            }
            
            const data = [
                userData.cash,
                userData.stocks,
                userData.crypto,
                userData.bonds,
                userData.etf + userData.savings + userData.preciousMetals
            ];
            
            assetChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['현금', '주식', '암호화폐', '채권', '기타'],
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            '#3B82F6', '#10B981', '#F59E0B', '#8B5CF6', '#EF4444'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Display asset details
        function displayAssetDetails() {
            const assets = [
                { name: '현금', amount: userData.cash, color: 'blue' },
                { name: '주식', amount: userData.stocks, color: 'green' },
                { name: '암호화폐', amount: userData.crypto, color: 'yellow' },
                { name: '채권', amount: userData.bonds, color: 'purple' },
                { name: 'ETF', amount: userData.etf, color: 'indigo' },
                { name: '예적금', amount: userData.savings, color: 'pink' },
                { name: '귀금속', amount: userData.preciousMetals, color: 'red' }
            ];
            
            const totalAssets = assets.reduce((sum, asset) => sum + asset.amount, 0);
            
            document.getElementById('assetDetails').innerHTML = assets
                .filter(asset => asset.amount > 0)
                .map(asset => {
                    const percentage = ((asset.amount / totalAssets) * 100).toFixed(1);
                    return `
                        <div class="flex justify-between items-center p-3 bg-${asset.color}-50 rounded-lg">
                            <span class="font-medium text-${asset.color}-700">${asset.name}</span>
                            <div class="text-right">
                                <p class="font-bold">${formatCurrency(asset.amount)}</p>
                                <p class="text-sm text-gray-600">${percentage}%</p>
                            </div>
                        </div>
                    `;
                }).join('');
        }

        // Generate rebalancing suggestion
        function generateRebalancingSuggestion() {
            const totalAssets = userData.cash + userData.stocks + userData.crypto + userData.bonds + userData.etf + userData.savings + userData.preciousMetals;
            const cashRatio = (userData.cash / totalAssets) * 100;
            
            let suggestions = [];
            
            if (cashRatio > 50) {
                suggestions.push('현금 비중이 높습니다. 투자 상품에 분산투자를 고려해보세요.');
            } else if (cashRatio < 10) {
                suggestions.push('현금 비중이 낮습니다. 비상자금을 확보하는 것이 좋습니다.');
            }
            
            const stockRatio = (userData.stocks / totalAssets) * 100;
            if (stockRatio > 60) {
                suggestions.push('주식 비중이 높습니다. 채권이나 안전자산으로 분산해보세요.');
            }
            
            const cryptoRatio = (userData.crypto / totalAssets) * 100;
            if (cryptoRatio > 20) {
                suggestions.push('암호화폐 비중이 높습니다. 리스크 관리를 위해 비중을 줄여보세요.');
            }
            
            if (suggestions.length === 0) {
                suggestions.push('현재 자산 배분이 양호합니다. 주기적으로 점검해보세요.');
            }
            
            document.getElementById('rebalancingSuggestion').innerHTML = suggestions
                .map(suggestion => `
                    <div class="p-3 bg-blue-50 border-l-4 border-blue-500 rounded-lg">
                        <p class="text-blue-700">${suggestion}</p>
                    </div>
                `).join('');
        }

        // Set goal
        function setGoal() {
            const goalAmount = parseInt(document.getElementById('goalAmount').value);
            const goalPeriod = parseInt(document.getElementById('goalPeriod').value);
            
            if (!goalAmount || !goalPeriod) {
                alert('목표 금액과 기간을 모두 입력하세요.');
                return;
            }
            
            const goal = {
                id: Date.now(),
                amount: goalAmount,
                period: goalPeriod,
                startDate: new Date().toISOString(),
                currentAmount: userData.cash + userData.stocks + userData.crypto + userData.bonds + userData.etf + userData.savings + userData.preciousMetals
            };
            
            householdData.goals.push(goal);
            saveData();
            
            // Show progress
            const progressContainer = document.getElementById('goalProgress');
            const progress = (goal.currentAmount / goal.amount) * 100;
            const monthlyRequired = (goal.amount - goal.currentAmount) / goal.period;
            
            progressContainer.innerHTML = `
                <h3 class="font-bold mb-2">목표 진행률</h3>
                <div class="w-full bg-gray-200 rounded-full h-3 mb-2">
                    <div class="bg-orange-500 h-3 rounded-full" style="width: ${Math.min(progress, 100)}%"></div>
                </div>
                <p class="text-sm text-gray-600">현재: ${formatCurrency(goal.currentAmount)} / 목표: ${formatCurrency(goal.amount)}</p>
                <p class="text-sm text-gray-600">월 필요액: ${formatCurrency(monthlyRequired)}</p>
            `;
            progressContainer.classList.remove('hidden');
        }

        // Update grade products
        function updateGradeProducts() {
            updateCurrentGradeBenefits();
            updateGradeRequirements();
            updatePremiumProducts();
        }

        // Update current grade benefits
        function updateCurrentGradeBenefits() {
            const totalAssets = userData.cash + userData.stocks + userData.crypto + userData.bonds + userData.etf + userData.savings + userData.preciousMetals;
            let benefits = ['기본 투자 상품 이용'];
            
            if (totalAssets >= gradeThresholds.silver) {
                benefits.push('ETF 투자 가능', '채권 투자 가능');
            }
            if (totalAssets >= gradeThresholds.gold) {
                benefits.push('귀금속 투자 가능', '해외 상품 이용 가능');
            }
            if (totalAssets >= gradeThresholds.platinum) {
                benefits.push('전문 컨설팅 서비스', '우대 수수료율 적용');
            }
            if (totalAssets >= gradeThresholds.diamond) {
                benefits.push('VIP 전용 상품', '개인 자산관리사 배정');
            }
            
            document.getElementById('currentGradeBenefits').innerHTML = benefits
                .map(benefit => `
                    <div class="flex items-center p-3 bg-green-50 rounded-lg">
                        <i class="fas fa-check-circle text-green-500 mr-3"></i>
                        <span class="text-green-700">${benefit}</span>
                    </div>
                `).join('');
        }

        // Update grade requirements
        function updateGradeRequirements() {
            const grades = [
                { name: '브론즈', threshold: 0, class: 'grade-bronze' },
                { name: '실버', threshold: 10000000, class: 'grade-silver' },
                { name: '골드', threshold: 20000000, class: 'grade-gold' },
                { name: '플래티넘', threshold: 50000000, class: 'grade-platinum' },
                { name: '다이아몬드', threshold: 100000000, class: 'grade-diamond' }
            ];
            
            const totalAssets = userData.cash + userData.stocks + userData.crypto + userData.bonds + userData.etf + userData.savings + userData.preciousMetals;
            
            document.getElementById('gradeRequirements').innerHTML = grades
                .map(grade => {
                    const achieved = totalAssets >= grade.threshold;
                    return `
                        <div class="flex justify-between items-center p-4 ${achieved ? 'bg-green-50 border border-green-200' : 'bg-gray-50 border border-gray-200'} rounded-lg">
                            <div class="flex items-center">
                                <div class="w-8 h-8 ${grade.class} rounded-full flex items-center justify-center mr-3">
                                    <i class="fas fa-${achieved ? 'check' : 'lock'} text-white text-sm"></i>
                                </div>
                                <span class="font-medium">${grade.name} 등급</span>
                            </div>
                            <span class="text-sm ${achieved ? 'text-green-600' : 'text-gray-600'}">
                                ${formatCurrency(grade.threshold)} 이상
                            </span>
                        </div>
                    `;
                }).join('');
        }

        // Update premium products
        function updatePremiumProducts() {
            const totalAssets = userData.cash + userData.stocks + userData.crypto + userData.bonds + userData.etf + userData.savings + userData.preciousMetals;
            
            const products = [
                {
                    name: 'ETF 포트폴리오',
                    grade: 'silver',
                    available: totalAssets >= gradeThresholds.silver,
                    description: '분산투자 ETF 상품'
                },
                {
                    name: '귀금속 투자',
                    grade: 'gold',
                    available: totalAssets >= gradeThresholds.gold,
                    description: '금, 은 등 귀금속 투자'
                },
                {
                    name: '프리미엄 컨설팅',
                    grade: 'platinum',
                    available: totalAssets >= gradeThresholds.platinum,
                    description: '전문가 1:1 투자 상담'
                },
                {
                    name: 'VIP 자산관리',
                    grade: 'diamond',
                    available: totalAssets >= gradeThresholds.diamond,
                    description: '개인 자산관리사 서비스'
                }
            ];
            
            document.getElementById('premiumProducts').innerHTML = products
                .map(product => `
                    <div class="p-4 border rounded-lg ${product.available ? 'border-blue-200 bg-blue-50' : 'border-gray-200 bg-gray-50'}">
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="font-bold ${product.available ? 'text-blue-700' : 'text-gray-500'}">${product.name}</h3>
                                <p class="text-sm ${product.available ? 'text-blue-600' : 'text-gray-400'}">${product.description}</p>
                                <p class="text-xs text-gray-500 mt-1">${getGradeName(product.grade)} 등급 이상</p>
                            </div>
                            <i class="fas fa-${product.available ? 'unlock' : 'lock'} text-2xl ${product.available ? 'text-blue-500' : 'text-gray-400'}"></i>
                        </div>
                    </div>
                `).join('');
        }

        // Simulate grade upgrade
        function simulateGradeUpgrade() {
            const targetGrade = document.getElementById('targetGrade').value;
            const targetThreshold = gradeThresholds[targetGrade];
            const currentAssets = userData.cash + userData.stocks + userData.crypto + userData.bonds + userData.etf + userData.savings + userData.preciousMetals;
            const required = targetThreshold - currentAssets;
            
            const resultContainer = document.getElementById('simulationResult');
            
            if (required <= 0) {
                resultContainer.innerHTML = `
                    <h3 class="font-bold text-green-700 mb-2">이미 ${getGradeName(targetGrade)} 등급입니다!</h3>
                    <p class="text-green-600">현재 자산으로 해당 등급의 모든 혜택을 이용할 수 있습니다.</p>
                `;
            } else {
                const monthsToAchieve = Math.ceil(required / (userData.initialFunds * 0.1)); // Assume 10% monthly growth
                resultContainer.innerHTML = `
                    <h3 class="font-bold text-purple-700 mb-2">${getGradeName(targetGrade)} 등급 달성 시뮬레이션</h3>
                    <p class="text-purple-600 mb-2">필요 자산: ${formatCurrency(required)}</p>
                    <p class="text-purple-600 mb-2">예상 달성 기간: 약 ${monthsToAchieve}개월</p>
                    <p class="text-sm text-gray-600">* 월 10% 수익률 가정</p>
                `;
            }
            
            resultContainer.classList.remove('hidden');
        }

        // Utility functions
        function getGradeName(grade) {
            const names = {
                bronze: '브론즈',
                silver: '실버',
                gold: '골드',
                platinum: '플래티넘',
                diamond: '다이아몬드'
            };
            return names[grade] || '브론즈';
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('ko-KR', {
                style: 'currency',
                currency: 'KRW'
            }).format(amount);
        }

        function saveData() {
            localStorage.setItem('fineUserData', JSON.stringify(userData));
            localStorage.setItem('fineHouseholdData', JSON.stringify(householdData));
        }
    </script>
</body>
</html>